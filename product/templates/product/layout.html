<!DOCTYPE html>
{% load static %}
<html>
<head>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
          integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z"
          crossorigin="anonymous">

        <title>MAHZARAT FASION DESIGN</title>


        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
              integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css"
              integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">

<script>

        var user = "{{ request.user }}"

    // django ajax csrftoken

function getToken(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
const csrftoken = getToken('csrftoken');


</script>

{% block style %}

    {% endblock %}


</head>
<body>



<nav class="navbar navbar-expand-lg navbar-dark bg-primary" style="color: white;">
  <a class="navbar-brand" href="#">Navbar</a>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">

    <ul class="navbar-nav mr-auto">


      <li class="nav-item active">
       <a class="nav-link" href="{% url 'home' %}"><span class="nav-item"><i class="fas fa-home"></i></span>
Home <span class="sr-only">(current)</span></a>
      </li>

              <li class="nav-item active">
       <a class="nav-link" href="{% url 'store' %}"><span class="nav-item"><i class="fas fa-item"></i></span>
Buy Your Product <span class="sr-only">(current)</span></a>
      </li>



      <li class="nav-item">
        <a class="nav-link" href="{% url 'contact' %}"><span class="nav-item"><i class="fas fa-phone"></i></span>
            Contact Us<span class="sr-only">(current)</span></a>
      </li>
        {% if user.is_authenticated %}

      <li class="nav-item">

        <a class="nav-link" href="{% url 'logout' %}"><span class="nav-item"><i class="fas fa-lock"></i></span>
          Logout <span class="sr-only">(current)</span></a>
      </li>


{% else %}

      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="{% url 'register' %}" id="navbarDropdown" role="button"
           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <span class="nav-item"><i class="fas fa-save"></i></span>

          Register Here
        </a>

        <div class="dropdown-menu" aria-labelledby="navbarDropdown">

          <a class="dropdown-item" href="{% url 'register' %}">Register As a customer</a>
          <a class="dropdown-item" href="#">Register As an agent</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="#">Register To Advertise our Cars</a>
        </div>

      </li>



      <li class="nav-item">

        <a class="nav-link" href="{% url 'login' %}"><span class="nav-item"><i class="fas fa-lock"></i></span>
          Login Here<span class="sr-only">(current)</span></a>
      </li>

        {% endif %}

    </ul>

  </div>
  <button class="navbar-toggler" type="button" data-toggle="collapse"
          data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>

  </button>

</nav>

{% if messages %}
    {% for message in messages %}
        <div class="alert alert-{{message.tags}}">
            {{message}}
        </div>
    {% endfor %}

{% endif %}

<br>
{% block body %}

{% endblock %}
<script>


var updateBtns = document.getElementsByClassName('update-cart');

    for(var i=0; i < updateBtns.length; i++){

        updateBtns[i].addEventListener('click', function(){

            var productId = this.dataset.product

            var action = this.dataset.action

            console.log('productId:', productId, 'Action:', action)

            console.log('USER', user)

            if(user == 'AnonymousUser'){

                addCookieItem()
            }

            else{
                updateUserOrder(productId, action)
            }


        })

    }

function addCookieItem(productId, action){
console.log("not logged in")

if(action == 'add'){

    if(cart[productId] == undefined){
        cart[productId] = {'quantity': 1}
    }
    else{
    cart[productId]['quantity'] += 1

    }
}


if(action == 'remove'){
    cart[productId]['quantity'] -= 1
    if(cart[productId]['quantity'] <= 0){
    console.log("remove item")
    delete cart[productId]
    }


}

}


function updateUserOrder(productId, action){

    console.log('user is authenticated sending data..')

    var url = "/update_item/"

    fetch(url, {

     method: 'POST',
     headers: {

        'Content-Type':'application/json',
        'X-CSRFToken': csrftoken,

    },

    body:JSON.stringify({'productId': productId, 'action': action})
    })

    .then((response) => {

        return response.json()
    })

    .then((data) => {
        console.log('data:', data)
    location.reload()


    })

}

</script>



<footer>
    <p style="color:blue;">Botokhan Road Jaja Jahun Bauchi </p>
</footer>
